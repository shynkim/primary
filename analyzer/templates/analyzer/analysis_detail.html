{% extends 'analyzer/base.html' %}
{% block title %}{{ analysis.file_name }} - ê°œì¸ì •ë³´ í•­ëª© ë¹„êµ ê²°ê³¼{% endblock %}

{% block content %}
<div class="container-xxl py-4">

  <!-- SECTION 1: APK ë‚´ë¶€ ê¶Œí•œ ë¼ë²¨ë§ -->
  <div class="mb-5">
    <h4 class="fw-bold mb-1">ğŸ“± APK ê¶Œí•œ ê¸°ë°˜ ê°œì¸ì •ë³´ í•­ëª©</h4>
    <p class="text-muted mb-4">ì•±ì´ ì‹¤ì œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ê°œì¸ì •ë³´ í•­ëª©ì…ë‹ˆë‹¤.</p>

    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body p-4">
        {% if analysis.permissions %}
          <div class="mb-3"><strong>ì´ {{ analysis.permissions|length }}ê°œ ê¶Œí•œ ê°ì§€ë¨</strong></div>
          <div class="d-flex flex-wrap gap-2">
            {% for p in analysis.permissions %}
              <span class="badge bg-primary-subtle text-primary">{{ p }}</span>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted">ê°ì§€ëœ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- SECTION 2: ì²˜ë¦¬ë°©ì¹¨ í…ìŠ¤íŠ¸ ë¼ë²¨ë§ -->
  <div class="mb-5">
    <h4 class="fw-bold mb-1">ğŸ“„ ì²˜ë¦¬ë°©ì¹¨ ê¸°ë°˜ ê°œì¸ì •ë³´ í•­ëª©</h4>
    <p class="text-muted mb-4">AI ëª¨ë¸ì´ ì²˜ë¦¬ë°©ì¹¨ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ì‹í•œ ê°œì¸ì •ë³´ í•­ëª©ì…ë‹ˆë‹¤.</p>

    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body p-4">
        {% if analysis.policy_labels %}
          <div class="mb-3"><strong>ì´ {{ analysis.policy_labels|length }}ê°œ í•­ëª© ì¸ì‹ë¨</strong></div>
          <div class="d-flex flex-wrap gap-2">
            {% for label in analysis.policy_labels %}
              <span class="badge bg-secondary-subtle text-secondary">{{ label }}</span>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted">ì²˜ë¦¬ë°©ì¹¨ì—ì„œ ì¸ì‹ëœ ê°œì¸ì •ë³´ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- SECTION 3: ë¹„êµ ê²°ê³¼ -->
  <div class="mb-5">
    <h4 class="fw-bold mb-1">ğŸ” ë¹„êµ ê²°ê³¼ (APK vs ì²˜ë¦¬ë°©ì¹¨)</h4>
    <p class="text-muted mb-4">ì•±ì´ ì‹¤ì œë¡œ ì ‘ê·¼í•˜ëŠ” í•­ëª©ê³¼ ì²˜ë¦¬ë°©ì¹¨ì— ëª…ì‹œëœ í•­ëª© ê°„ì˜ ì¼ì¹˜ë„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>

    {% with comp=analysis.comparison %}
    <div class="card border-0 shadow-sm rounded-4 mb-4">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            ì „ì²´ ì¼ì¹˜ë„
            <small class="text-muted">
              ({{ comp.totals.matched }}ê°œ ì¼ì¹˜ / {{ comp.totals.total }}ê°œ í•­ëª© ì¤‘)
            </small>
          </div>
          <h3 class="fw-bold text-warning mb-0">{{ comp.totals.percentage }}%</h3>
        </div>
        <div class="progress bg-light" style="height:10px;">
          <div class="progress-bar bg-warning" style="width: {{ comp.totals.percentage }}%"></div>
        </div>
      </div>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="stat-box bg-success-subtle text-success">
          <div class="h4 mb-0">{{ comp.totals.matched }}</div>
          <small>ì¼ì¹˜ í•­ëª©</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-box bg-danger-subtle text-danger">
          <div class="h4 mb-0">{{ comp.only_perm|length }}</div>
          <small>ì•±ì—ëŠ” ìˆìœ¼ë‚˜ ì²˜ë¦¬ë°©ì¹¨ì— ì—†ìŒ</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-box bg-warning-subtle text-warning">
          <div class="h4 mb-0">{{ comp.only_policy|length }}</div>
          <small>ì²˜ë¦¬ë°©ì¹¨ì—ëŠ” ìˆìœ¼ë‚˜ ì•±ì—ëŠ” ì—†ìŒ</small>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- ì¼ì¹˜ í•­ëª© -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4">
          <div class="card-body">
            <h6 class="text-success mb-3"><i class="fa-regular fa-circle-check me-2"></i>ì¼ì¹˜ í•­ëª©</h6>
            {% for l in comp.matched %}
              <div class="match-item bg-success-subtle text-success p-2 rounded-3 mb-1 small">{{ l }}</div>
            {% empty %}<p class="text-muted small">ì¼ì¹˜ í•­ëª© ì—†ìŒ</p>{% endfor %}
          </div>
        </div>
      </div>

      <!-- ì•±ì—ëŠ” ìˆìœ¼ë‚˜ ì²˜ë¦¬ë°©ì¹¨ì— ì—†ìŒ -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4">
          <div class="card-body">
            <h6 class="text-danger mb-3"><i class="fa-regular fa-circle-xmark me-2"></i>ì•±ì—ë§Œ ì¡´ì¬ (ë¯¸ê³ ì§€)</h6>
            {% for l in comp.only_perm %}
              <div class="match-item bg-danger-subtle text-danger p-2 rounded-3 mb-1 small">{{ l }}</div>
            {% empty %}<p class="text-muted small">ì—†ìŒ</p>{% endfor %}
          </div>
        </div>
      </div>

      <!-- ì²˜ë¦¬ë°©ì¹¨ì—ëŠ” ìˆìœ¼ë‚˜ ì•±ì— ì—†ìŒ -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4">
          <div class="card-body">
            <h6 class="text-warning mb-3"><i class="fa-regular fa-circle-exclamation me-2"></i>ì²˜ë¦¬ë°©ì¹¨ì—ë§Œ ì¡´ì¬ (ë¶ˆí•„ìš” ëª…ì‹œ)</h6>
            {% for l in comp.only_policy %}
              <div class="match-item bg-warning-subtle text-warning p-2 rounded-3 mb-1 small">{{ l }}</div>
            {% empty %}<p class="text-muted small">ì—†ìŒ</p>{% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endwith %}
  </div>

  <div class="text-center mt-5">
    <a href="{% url 'analyzer:index' %}" class="btn btn-outline-secondary btn-lg px-4">ìƒˆë¡œìš´ ë¶„ì„ ì‹œì‘í•˜ê¸°</a>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  body {
    background:
      radial-gradient(900px 500px at 12% 2%, #e9eeff 0%, transparent 60%),
      radial-gradient(900px 500px at 88% 2%, #e9ffee 0%, transparent 60%),
      #f8faff;
  }

  .bg-success-subtle { background: #eaf8ef !important; }
  .bg-danger-subtle  { background: #fdecec !important; }
  .bg-warning-subtle { background: #fff4e5 !important; }
  .bg-primary-subtle { background: #eef2ff !important; }
  .bg-secondary-subtle { background: #f3f4f6 !important; }

  .text-success { color: #16a34a !important; }
  .text-danger  { color: #ef4444 !important; }
  .text-warning { color: #f59e0b !important; }
  .text-primary { color: #3b82f6 !important; }
  .text-secondary { color: #64748b !important; }

  .stat-box {
    border-radius: 1rem;
    padding: 1rem;
    text-align: center;
    font-weight: 600;
    border: 1px solid #e5e7eb;
  }

  .match-item {
    border: 1px solid #e5e7eb;
  }
</style>
{% endblock %}
